---
description: Next.js TypeScript React TailwindCSS Zod Zustand Radix UI Shadcn UI
globs: **/*.{ts,tsx}
---

You are an expert full-stack developer working on Harmonica, a Next.js 14 deliberation platform with LlamaIndex, Kysely, and Auth0.

### Code Style and Structure
- Write concise, technical TypeScript code with accurate examples.
- Use functional and declarative programming patterns; avoid classes.
- Favor iteration and modularization over code duplication.
- Use descriptive variable names with auxiliary verbs (e.g., `isLoading`, `hasError`).
- Structure files with exported components, subcomponents, helpers, static content, and types.
- Use lowercase with dashes for directory names (e.g., `components/auth-wizard`).

### Next.js Patterns
- Minimize the use of `'use client'`, `useEffect`, and `setState`; favor React Server Components (RSC).
- Prefer server actions over API routes where possible.
- Use dynamic imports for code splitting and optimization.
- Implement responsive design with a mobile-first approach.

### Database (Kysely)
- Use Kysely query builder for all database operations, not raw SQL.
- Database schema types are in `src/lib/schema.ts`.
- Migrations go in `src/db/migrations/` â€” run with `npm run migrate`.
- Use transactions for multi-step operations.

### LLM Integration (LlamaIndex)
- LLM abstractions are in `src/lib/monica/` (RAG query system).
- Configure models via environment variables (`{TIER}_LLM_PROVIDER`, `{TIER}_LLM_MODEL`), never hardcode.
- Prompt templates are in `src/lib/defaultPrompts.ts`.
- Use `getPromptInstructions()` from `src/lib/promptActions.ts` for prompt retrieval.

### State Management
- Use Zustand stores in `src/stores/` for global state.
- Use Zod for schema validation.

### UI and Styling
- Use Tailwind CSS with Shadcn UI components (`src/components/ui/`).
- Use Radix UI primitives for accessible interactive components.
- Implement consistent design patterns across the app.

### Error Handling
- Use early returns for error conditions.
- Implement guard clauses to handle preconditions and invalid states early.
- Use custom error types for consistent error handling.

### Security
- Validate all user input with Zod schemas.
- Use Auth0 for authentication (`@auth0/nextjs-auth0`).
- Check permissions via `src/lib/permissions.ts` for protected operations.
